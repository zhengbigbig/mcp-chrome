# ğŸ” Chrome Extension æŠ€æœ¯æµç¨‹åˆ†æ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

chrome-extensionæ˜¯ä¸€ä¸ªåŸºäºMCPï¼ˆModel Context Protocolï¼‰çš„æ™ºèƒ½æµè§ˆå™¨åŠ©æ‰‹ï¼Œé‡‡ç”¨åŒæ¶æ„è®¾è®¡ï¼š

- **Sidepanel**: ä½œä¸ºMCP Clientï¼Œç»“åˆå®¿ä¸»æ¨¡å‹ï¼ˆOllamaï¼‰æä¾›æ™ºèƒ½æ¨ç†èƒ½åŠ›
- **Background**: ä½œä¸ºMCP Serverï¼Œæä¾›æµè§ˆå™¨å·¥å…·å’Œå†…éƒ¨æœåŠ¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Chrome Extension                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sidepanel (MCP Client)           â”‚  Background (MCP Server) â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  NewApp.tsx (ä¸»ç•Œé¢)        â”‚   â”‚  â”‚  Internal MCP Server â”‚ â”‚
â”‚  â”‚  â”œâ”€ EnhancedReasoningEngine â”‚   â”‚  â”‚  â”œâ”€ å·¥å…·æ³¨å†Œ        â”‚ â”‚
â”‚  â”‚  â”œâ”€ PromptSystem           â”‚   â”‚  â”‚  â”œâ”€ è¯·æ±‚å¤„ç†        â”‚ â”‚
â”‚  â”‚  â”œâ”€ OllamaClient          â”‚   â”‚  â”‚  â””â”€ å“åº”è¿”å›        â”‚ â”‚
â”‚  â”‚  â””â”€ SimpleMCPHelper       â”‚   â”‚  â”‚                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                        â”‚           â”‚              â”‚
â”‚           â”‚ chrome.runtime.sendMessage        â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                    â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ExternalMCPConfig         â”‚   â”‚  â”‚  Browser Tools      â”‚ â”‚
â”‚  â”‚  (å¤–éƒ¨MCPé…ç½®ç®¡ç†)          â”‚   â”‚  â”‚  â”œâ”€ æˆªå›¾å·¥å…·        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”œâ”€ å¯¼èˆªå·¥å…·        â”‚ â”‚
â”‚                                    â”‚  â”‚  â”œâ”€ å†…å®¹è·å–        â”‚ â”‚
â”‚                                    â”‚  â”‚  â””â”€ é¡µé¢äº¤äº’        â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®æµç¨‹

### 1. **ç”¨æˆ·è¾“å…¥æµç¨‹**

```
ç”¨æˆ·è¾“å…¥ â†’ NewApp.tsx â†’ EnhancedReasoningEngine â†’ PromptSystem â†’ OllamaClient
    â†“
å®¿ä¸»æ¨¡å‹æ¨ç† â†’ å·¥å…·é€‰æ‹© â†’ SimpleMCPHelper â†’ chrome.runtime.sendMessage
    â†“
Background MCP Server â†’ å·¥å…·æ‰§è¡Œ â†’ ç»“æœè¿”å› â†’ ç”¨æˆ·ç•Œé¢å±•ç¤º
```

### 2. **MCPè¯·æ±‚æµç¨‹**

```
Sidepanel MCP Client â†’ chrome.runtime.sendMessage â†’ Background MCP Server
    â†“
Internal MCP Server â†’ å·¥å…·æ³¨å†Œè¡¨ â†’ å·¥å…·æ‰§è¡Œå™¨ â†’ ç»“æœå¤„ç†
    â†“
JSON-RPCå“åº” â†’ chrome.runtime.onMessage â†’ Sidepanel MCP Client
```

### 3. **å¤–éƒ¨MCPæœåŠ¡å™¨æµç¨‹**

```
ExternalMCPConfig â†’ multiMCPClient â†’ ServerRegistry â†’ HTTP/WebSocket/STDIO
    â†“
å¤–éƒ¨MCPæœåŠ¡å™¨ â†’ å·¥å…·åˆ—è¡¨ â†’ å·¥å…·è°ƒç”¨ â†’ ç»“æœè¿”å›
```

## ğŸ“ ä»£ç ç»“æ„åˆ†æ

### Sidepanel (MCP Client)

#### æ ¸å¿ƒç»„ä»¶

- **NewApp.tsx**: ä¸»ç•Œé¢ç»„ä»¶ï¼Œé›†æˆæ‰€æœ‰åŠŸèƒ½
- **EnhancedReasoningEngine.ts**: å¢å¼ºæ¨ç†å¼•æ“ï¼Œæ™ºèƒ½ä»»åŠ¡åˆ†æ
- **PromptSystem.ts**: æ™ºèƒ½æç¤ºè¯ç³»ç»Ÿï¼ŒLLMå·¥å…·é€‰æ‹©
- **OllamaClient.ts**: Ollamaå®¿ä¸»æ¨¡å‹å®¢æˆ·ç«¯
- **SimpleMCPHelper.ts**: ç®€åŒ–çš„MCPé€šä¿¡åŠ©æ‰‹

#### æœåŠ¡å±‚

- **ReasoningEngine.ts**: åŸå§‹æ¨ç†å¼•æ“ï¼ˆå·²åºŸå¼ƒï¼‰
- **MCPClientService.ts**: å¤æ‚MCPå®¢æˆ·ç«¯æœåŠ¡ï¼ˆå·²åºŸå¼ƒï¼‰
- **App.tsx**: åŸå§‹åº”ç”¨ç»„ä»¶ï¼ˆå·²åºŸå¼ƒï¼‰

### Background (MCP Server)

#### æ ¸å¿ƒæœåŠ¡

- **mcp-internal-server.ts**: å†…éƒ¨MCPæœåŠ¡å™¨å®ç°
- **tools/index.ts**: æµè§ˆå™¨å·¥å…·æ³¨å†Œå…¥å£
- **tools/browser/**: æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·é›†åˆ

#### è¾…åŠ©æœåŠ¡

- **native-host.ts**: åŸç”Ÿä¸»æœºé€šä¿¡ï¼ˆå¯èƒ½å·²åºŸå¼ƒï¼‰
- **semantic-similarity.ts**: è¯­ä¹‰ç›¸ä¼¼æ€§æœåŠ¡
- **storage-manager.ts**: å­˜å‚¨ç®¡ç†æœåŠ¡

### å·¥å…·å±‚ (Utils)

#### MCPç›¸å…³

- **multi-mcp-client.ts**: å¤šMCPæœåŠ¡å™¨å®¢æˆ·ç«¯
- **server-registry.ts**: MCPæœåŠ¡å™¨æ³¨å†Œè¡¨
- **background-mcp-server.ts**: åå°MCPæœåŠ¡å™¨åŒ…è£…å™¨
- **mcp-reasoning.ts**: MCPæ¨ç†å¼•æ“
- **internal-mcp-client.ts**: å†…éƒ¨MCPå®¢æˆ·ç«¯
- **mcp-client.ts**: åŸºç¡€MCPå®¢æˆ·ç«¯
- **user-interaction.ts**: ç”¨æˆ·äº¤äº’å¤„ç†

#### å…¶ä»–å·¥å…·

- **content-indexer.ts**: å†…å®¹ç´¢å¼•å™¨
- **semantic-similarity-engine.ts**: è¯­ä¹‰ç›¸ä¼¼æ€§å¼•æ“
- **vector-database.ts**: å‘é‡æ•°æ®åº“
- **image-utils.ts**: å›¾åƒå¤„ç†å·¥å…·

## ğŸ¯ åŠŸèƒ½æ¨¡å—åˆ†æ

### 1. **æ™ºèƒ½æ¨ç†ç³»ç»Ÿ**

- **PromptSystem**: åŸºäºLLMçš„ä»»åŠ¡ç†è§£å’Œå·¥å…·é€‰æ‹©
- **EnhancedReasoningEngine**: ä»»åŠ¡åˆ†è§£å’Œæ‰§è¡Œè®¡åˆ’
- **OllamaClient**: å®¿ä¸»æ¨¡å‹é›†æˆ

### 2. **MCPé€šä¿¡å±‚**

- **SimpleMCPHelper**: ç®€åŒ–çš„å†…éƒ¨é€šä¿¡
- **multi-mcp-client**: å¤–éƒ¨MCPæœåŠ¡å™¨ç®¡ç†
- **server-registry**: æœåŠ¡å™¨çŠ¶æ€ç›‘æ§

### 3. **æµè§ˆå™¨å·¥å…·é›†**

- æˆªå›¾ã€å¯¼èˆªã€å†…å®¹è·å–ã€é¡µé¢äº¤äº’ç­‰
- é€šè¿‡Internal MCP Serveræš´éœ²
- æ”¯æŒå·¥å…·ç»„åˆå’Œé“¾å¼è°ƒç”¨

### 4. **å¤–éƒ¨MCPé›†æˆ**

- HTTP/WebSocket/STDIOä¼ è¾“æ”¯æŒ
- å¤šç§è®¤è¯æ–¹å¼
- æ™ºèƒ½è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»

## ğŸ” ä»£ç å†—ä½™åˆ†æ

### å·²åºŸå¼ƒçš„ç»„ä»¶

1. **App.tsx**: è¢«NewApp.tsxæ›¿ä»£
2. **ReasoningEngine.ts**: è¢«EnhancedReasoningEngine.tsæ›¿ä»£
3. **MCPClientService.ts**: è¢«SimpleMCPHelper.tsæ›¿ä»£
4. **style.css**: è¢«new-style.cssæ›¿ä»£

### å¯èƒ½åºŸå¼ƒçš„æœåŠ¡

1. **native-host.ts**: ä¸å½“å‰æ¶æ„ä¸åŒ¹é…
2. **background-mcp-server.ts**: ä¸mcp-internal-server.tsé‡å¤
3. **mcp-reasoning.ts**: åŠŸèƒ½ä¸sidepanelæ¨ç†å¼•æ“é‡å¤

### æœªä½¿ç”¨çš„å·¥å…·

1. **content-indexer.ts**: è¯­ä¹‰æœç´¢åŠŸèƒ½æœªé›†æˆ
2. **semantic-similarity-engine.ts**: å¤§å‹è¯­ä¹‰å¼•æ“æœªä½¿ç”¨
3. **vector-database.ts**: å‘é‡æ•°æ®åº“åŠŸèƒ½æœªæ¿€æ´»

## ğŸ“Š æŠ€æœ¯æ ˆæ€»ç»“

### å‰ç«¯æŠ€æœ¯

- **React 18**: ç”¨æˆ·ç•Œé¢æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨
- **CSS3**: æ ·å¼å’ŒåŠ¨ç”»

### MCPæŠ€æœ¯

- **@modelcontextprotocol/sdk**: å®˜æ–¹MCP SDK
- **JSON-RPC 2.0**: é€šä¿¡åè®®
- **å¤šç§ä¼ è¾“å±‚**: HTTPã€WebSocketã€STDIO

### AIé›†æˆ

- **Ollama**: æœ¬åœ°LLMæœåŠ¡
- **æ™ºèƒ½æç¤ºè¯**: ä»»åŠ¡ç†è§£å’Œå·¥å…·é€‰æ‹©
- **æ¨ç†å¼•æ“**: ä»»åŠ¡åˆ†è§£å’Œæ‰§è¡Œè®¡åˆ’

## ğŸš€ ä¼˜åŒ–å»ºè®®

### 1. **ä»£ç æ¸…ç†**

- ç§»é™¤åºŸå¼ƒçš„ç»„ä»¶å’ŒæœåŠ¡
- ç»Ÿä¸€MCPé€šä¿¡å±‚å®ç°
- æ¸…ç†æœªä½¿ç”¨çš„å·¥å…·å’Œä¾èµ–

### 2. **æ¶æ„ä¼˜åŒ–**

- ç®€åŒ–MCPå®¢æˆ·ç«¯å±‚æ¬¡
- ç»Ÿä¸€å·¥å…·æ³¨å†Œå’Œç®¡ç†
- ä¼˜åŒ–çŠ¶æ€ç®¡ç†å’Œé€šä¿¡æœºåˆ¶

### 3. **åŠŸèƒ½æ•´åˆ**

- é›†æˆè¯­ä¹‰æœç´¢åŠŸèƒ½
- æ¿€æ´»å‘é‡æ•°æ®åº“
- ç»Ÿä¸€AIæœåŠ¡æ¥å£

## ğŸ“ æ€»ç»“

chrome-extensioné‡‡ç”¨äº†ç°ä»£åŒ–çš„MCPæ¶æ„è®¾è®¡ï¼Œsidepanelä½œä¸ºæ™ºèƒ½å®¢æˆ·ç«¯ï¼Œbackgroundä½œä¸ºå·¥å…·æœåŠ¡å™¨ï¼Œå®ç°äº†æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„æ™ºèƒ½åŒ–ã€‚æ•´ä½“æ¶æ„æ¸…æ™°ï¼Œä½†å­˜åœ¨ä¸€äº›ä»£ç å†—ä½™å’Œæœªä½¿ç”¨çš„åŠŸèƒ½æ¨¡å—ï¼Œéœ€è¦è¿›è¡Œæ¸…ç†å’Œä¼˜åŒ–ã€‚
